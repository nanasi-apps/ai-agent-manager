# テンプレート一覧

このディレクトリには、エージェントやMCPツールに渡すコンテキスト/メッセージのテンプレートが含まれています。

## 変数構文

- `{{variable}}` — 変数の展開
- `{{#if variable}}...{{/if}}` — 変数が存在する場合のみ表示

---

## エージェント向けテンプレート

### `worktree-instructions.md`

**使用タイミング**: セッションの**最初のメッセージ**で、システムプロンプトに追加される

**トリガー条件**: `messageCount === 0` かつ `activeWorktree` がない場合

**目的**: エージェントにworktree作成のワークフローを教える

**変数**:
| 変数名 | 説明 |
|--------|------|
| `sessionId` | セッションID |
| `projectRoot` | プロジェクトルートパス（存在する場合） |
| `branchSuggestion` | 推奨ブランチ名プレフィックス（例: `agent/abc12345`） |

---

### `worktree-resume.md`

**使用タイミング**: **worktree切替後**のエージェント再開時

**トリガー条件**: `worktree_create` MCPツールで `resume: true` が指定され、エージェントプロセスが再起動した後

**目的**: worktree内で作業を継続するようエージェントに指示する

**変数**:
| 変数名 | 説明 |
|--------|------|
| `branch` | 作成されたブランチ名 |
| `worktreePath` | worktreeのパス |
| `originalMessage` | 元のユーザーリクエスト（存在する場合） |

---

## MCPツール向けテンプレート (`mcp/`)

### `mcp/worktree-create-result.md`

**使用タイミング**: `worktree_create` MCPツールの**レスポンス**

**目的**: worktree作成結果をエージェントに返す

**変数**:
| 変数名 | 説明 |
|--------|------|
| `createOutput` | git gtr newの出力 |
| `worktreePath` | 作成されたworktreeのパス |
| `resumeScheduled` | 再開がスケジュールされた場合に表示 |
| `resumeError` | 再開スケジュール失敗時のエラー |

---

### `mcp/conflict-resolution.md`

**使用タイミング**: `worktree_complete` MCPツールで**マージコンフリクト**が発生した場合

**目的**: コンフリクトの解決方法をエージェントに指示する

**変数**:
| 変数名 | 説明 |
|--------|------|
| `targetBranch` | マージ先のブランチ名 |
| `conflictedFiles` | コンフリクトしたファイル一覧（`- file` 形式） |

---

## フロー図

```
ユーザーメッセージ
       │
       ▼
┌──────────────────────────────────────────┐
│ messageCount === 0 かつ worktree未使用?  │
│   YES → worktree-instructions.md         │
│         (システムプロンプトに追加)         │
│   NO  → 何も追加しない                   │
└──────────────────────────────────────────┘
       │
       ▼
  エージェントが処理
       │
       ▼
┌──────────────────────────────────────────┐
│ worktree_create 呼び出し?                │
│   → mcp/worktree-create-result.md       │
│     (MCPツールレスポンス)                │
└──────────────────────────────────────────┘
       │
       ▼
┌──────────────────────────────────────────┐
│ resume: true でプロセス再起動?           │
│   → worktree-resume.md                  │
│     (再開メッセージとして送信)           │
└──────────────────────────────────────────┘
```
